var hue=function($,colors){'use strict';var shortFlashType='select',longFlashType='lselect',bridgeIP='',apiKey='',baseUrl='http://'+bridgeIP+'/api',baseApiUrl=baseUrl+'/'+apiKey,lastResult=null,numberOfLamps=3,offState={on:false},onState={on:true},shortFlashState={alert:shortFlashType},longFlashState={alert:longFlashType},transitionTime=null,updateURLs=function(){baseUrl='http://'+bridgeIP+'/api';baseApiUrl=baseUrl+'/'+apiKey;},apiSuccess=function(data,successText,jqXHR){lastResult=data;},putJSON=function(url,callback,data){var options={type:'PUT',url:url,success:callback,dataType:'json',contentType:'application/json',data:JSON.stringify(data)};$.ajax(options);return data;},get=function(destination,success){var callback=success||null,stateData=null;callback=null===callback?apiSuccess:success;$.ajaxSetup({async:false});$.getJSON(destination,function(data){stateData=data;});return stateData;},buildStateURL=function(lampIndex){return baseApiUrl+'/lights/'+lampIndex+'/state';},buildGroupActionURL=function(groupIndex){return baseApiUrl+'/groups/'+groupIndex+'/action';},put=function(lampIndex,data,success){var callback=success||null;callback=null===callback?apiSuccess:success;return putJSON(buildStateURL(lampIndex),callback,data);},putGroupAction=function(groupIndex,action){var callback=apiSuccess;return putJSON(buildGroupActionURL(groupIndex),callback,action);},putAll=function(data,success){var callback=success||null;callback=null===callback?apiSuccess:success;for(var i=0;i<numberOfLamps;++i){putJSON(buildStateURL(i+1),callback,data);}
return data;},buildLampQueryURL=function(lampIndex){return baseApiUrl+'/lights/'+lampIndex;},buildXYState=function(xyCoords){var stateObj={xy:xyCoords};if(typeof(transitionTime)==='number'){stateObj.transitiontime=transitionTime;}
return stateObj;},getBrightness=function(lampIndex){var lampState=get(buildLampQueryURL(lampIndex));return lampState.state.bri;},buildBrightnessState=function(brightness){var stateObj={bri:brightness};return stateObj;};return{flash:function(lampIndex){return put(lampIndex,shortFlashState);},flashAll:function(){return putAll(shortFlashState);},longFlash:function(lampIndex){return put(lampIndex,longFlashState);},longFlashAll:function(){return putAll(longFlashState);},setColor:function(lampIndex,color){var state=buildXYState(colors.getCIEColor(color));return put(lampIndex,state);},setAllColors:function(color){var state=buildXYState(colors.getCIEColor(color));return putGroupAction(0,state);},turnOff:function(lampIndex){return put(lampIndex,offState);},turnOn:function(lampIndex){return put(lampIndex,onState);},turnOffAll:function(){return putGroupAction(0,offState);},turnOnAll:function(){return putGroupAction(0,onState);},setBrightness:function(lampIndex,brightness){var state=buildBrightnessState(brightness);return put(lampIndex,state);},setAllBrightness:function(brightness){var state=buildBrightnessState(brightness);return putGroupAction(0,state);},setGroupBrightness:function(groupIndex,brightness){var state=buildBrightnessState(brightness);return putGroupAction(groupIndex,state);},dim:function(lampIndex,decrement){decrement=decrement||10;var currentBrightness=getBrightness(lampIndex);var newBrightness=(currentBrightness-decrement>0)?currentBrightness-decrement:0;return this.setBrightness(lampIndex,newBrightness);},dimAll:function(decrement){var states=[];for(var i=0;i<numberOfLamps;++i){states[i]=this.dim(i+1,decrement);}
return states;},raise:function(lampIndex,increment){increment=increment||10;var currentBrightness=getBrightness(lampIndex);var newBrightness=(currentBrightness+increment<255)?currentBrightness+increment:254;return this.setBrightness(lampIndex,newBrightness);},raiseAll:function(lampIndex,increment){var states=[];for(var i=0;i<numberOfLamps;++i){states[i]=this.raise(i+1,increment);}
return states;},getTransitionTime:function(){return transitionTime;},setTransitionTime:function(time){transitionTime=time;},setIpAndApiKey:function(ip,key){apiKey=key;bridgeIP=ip;updateURLs();}};};if(typeof(define)!=='undefined'&&typeof(define.amd)!=='undefined'){define(["../jquery","./colors"],hue);}else{window.hue=hue(window.jQuery,window.colors);}